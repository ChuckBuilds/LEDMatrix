<div class="bg-white rounded-lg shadow p-6">
    <div class="border-b border-gray-200 pb-4 mb-6">
        <h2 class="text-lg font-semibold text-gray-900">System Overview</h2>
        <p class="mt-1 text-sm text-gray-600">Monitor system status and manage your LED matrix display.</p>
    </div>

    <!-- System Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-microchip text-blue-600 text-xl"></i>
                </div>
                <div class="ml-3 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">CPU Usage</dt>
                        <dd class="text-lg font-medium text-gray-900" id="cpu-usage">--%</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-memory text-green-600 text-xl"></i>
                </div>
                <div class="ml-3 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">Memory Usage</dt>
                        <dd class="text-lg font-medium text-gray-900" id="memory-usage">--%</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-thermometer-half text-red-600 text-xl"></i>
                </div>
                <div class="ml-3 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">CPU Temperature</dt>
                        <dd class="text-lg font-medium text-gray-900" id="cpu-temp">--Â°C</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-desktop text-purple-600 text-xl"></i>
                </div>
                <div class="ml-3 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">Display Status</dt>
                        <dd class="text-lg font-medium text-gray-900" id="display-status">Unknown</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="border-b border-gray-200 pb-4 mb-6">
        <h3 class="text-md font-medium text-gray-900 mb-4">Quick Actions</h3>
        <div class="flex flex-wrap gap-3">
            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "start_display"}'
                    hx-swap="none"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">
                <i class="fas fa-play mr-2"></i>
                Start Display
            </button>

            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "stop_display"}'
                    hx-swap="none"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
                <i class="fas fa-stop mr-2"></i>
                Stop Display
            </button>

            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "git_pull"}'
                    hx-swap="none"
                    class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-download mr-2"></i>
                Update Code
            </button>

            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "reboot_system"}'
                    hx-confirm="Are you sure you want to reboot the system?"
                    hx-swap="none"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700">
                <i class="fas fa-power-off mr-2"></i>
                Reboot System
            </button>
        </div>
    </div>

    <!-- Display Preview -->
    <div>
        <h3 class="text-md font-medium text-gray-900 mb-4">
            <i class="fas fa-desktop"></i> Live Display Preview
        </h3>
        <div class="bg-gray-900 rounded-lg p-6 border border-gray-700" style="position: relative;">
            <div id="previewStage" class="preview-stage" style="display:none; position:relative; display:inline-block;">
                <div id="previewMeta" style="position:absolute; top:-28px; left:0; color:#ddd; font-size:12px; opacity:0.85;"></div>
                <img id="displayImage" style="image-rendering: pixelated; display: block;" alt="LED Matrix Display">
                <canvas id="ledCanvas" style="position:absolute; top:0; left:0; pointer-events:none; display:none;"></canvas>
                <canvas id="gridOverlay" style="position:absolute; top:0; left:0; pointer-events:none;"></canvas>
            </div>
            <div id="displayPlaceholder" class="text-center text-gray-400 py-8">
                <i class="fas fa-spinner fa-spin text-4xl mb-3"></i>
                <p>Connecting to display...</p>
            </div>
        </div>
        
        <!-- Display Controls -->
        <div class="mt-4 flex flex-wrap items-center gap-3">
            <button onclick="takeScreenshot()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-camera mr-2"></i> Screenshot
            </button>
            
            <label class="inline-flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-md text-sm">
                <span>Scale:</span>
                <input type="range" id="scaleRange" min="2" max="16" value="8" class="w-20">
                <span id="scaleValue" class="font-medium">8x</span>
            </label>
            
            <label class="inline-flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-md text-sm cursor-pointer">
                <input type="checkbox" id="toggleGrid" class="rounded">
                <span>Show pixel grid</span>
            </label>
            
            <label class="inline-flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-md text-sm cursor-pointer">
                <input type="checkbox" id="toggleLedDots" checked class="rounded">
                <span>LED dot mode</span>
            </label>
            
            <label class="inline-flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-md text-sm">
                <span>Dot fill:</span>
                <input type="range" id="dotFillRange" min="40" max="95" value="75" class="w-16">
                <span id="dotFillValue" class="font-medium">75%</span>
            </label>
        </div>
    </div>
</div>

<!-- Stats are updated via the global updateSystemStats function in base.html -->

<script>
// Setup display preview controls (runs when this partial loads)
(function() {
    const scaleRange = document.getElementById('scaleRange');
    const scaleValue = document.getElementById('scaleValue');
    const dotFillRange = document.getElementById('dotFillRange');
    const dotFillValue = document.getElementById('dotFillValue');
    const toggleGrid = document.getElementById('toggleGrid');
    const toggleLedDots = document.getElementById('toggleLedDots');
    
    if (scaleRange && scaleValue) {
        scaleRange.addEventListener('input', function() {
            scaleValue.textContent = this.value + 'x';
            // Re-render the preview with new scale
            const img = document.getElementById('displayImage');
            if (img && img.src) {
                const data = {
                    image: img.src.replace('data:image/png;base64,', ''),
                    width: img.naturalWidth,
                    height: img.naturalHeight
                };
                updateDisplayPreview(data);
            }
        });
    }
    
    if (dotFillRange && dotFillValue) {
        dotFillRange.addEventListener('input', function() {
            dotFillValue.textContent = this.value + '%';
            renderLedDots();
        });
    }
    
    if (toggleGrid) {
        toggleGrid.addEventListener('change', function() {
            const canvas = document.getElementById('gridOverlay');
            const img = document.getElementById('displayImage');
            if (canvas && img && img.src) {
                const scale = parseInt(scaleRange?.value || '8');
                drawGrid(canvas, img.naturalWidth, img.naturalHeight, scale);
            }
        });
    }
    
    if (toggleLedDots) {
        toggleLedDots.addEventListener('change', function() {
            renderLedDots();
        });
    }
})();
</script>

