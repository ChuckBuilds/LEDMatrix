<div class="bg-white rounded-lg shadow p-6">
    <div class="border-b border-gray-200 pb-4 mb-6">
        <h2 class="text-lg font-semibold text-gray-900">Sports Configuration</h2>
        <p class="mt-1 text-sm text-gray-600">Configure which sports leagues to display and their settings.</p>
    </div>

    <div id="sports-loading" class="animate-pulse space-y-4">
        <div class="h-8 bg-gray-200 rounded w-1/4"></div>
        <div class="space-y-3">
            <div class="h-16 bg-gray-200 rounded"></div>
            <div class="h-16 bg-gray-200 rounded"></div>
            <div class="h-16 bg-gray-200 rounded"></div>
        </div>
    </div>

    <div id="sports-content" class="hidden">
        <!-- Sports configuration will be loaded dynamically -->
    </div>

    <!-- On-Demand Controls -->
    <div class="mt-6 pt-6 border-t border-gray-200">
        <h3 class="text-md font-medium text-gray-900 mb-4">Quick Actions</h3>
        <div class="flex flex-wrap gap-3">
            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "start_display", "mode": "nfl_live"}'
                    hx-swap="none"
                    class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                <i class="fas fa-bolt mr-2"></i>
                NFL Live
            </button>
            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "start_display", "mode": "mlb_live"}'
                    hx-swap="none"
                    class="btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                <i class="fas fa-bolt mr-2"></i>
                MLB Live
            </button>
            <button hx-post="/api/v3/system/action"
                    hx-vals='{"action": "start_display", "mode": "nhl_live"}'
                    hx-swap="none"
                    class="btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md">
                <i class="fas fa-bolt mr-2"></i>
                NHL Live
            </button>
        </div>
    </div>
</div>

<script>
// Load sports configuration when partial loads
document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('sports-content')) {
        loadSportsConfig();
    }
});

function loadSportsConfig() {
    // Hide loading, show content area
    document.getElementById('sports-loading').classList.add('hidden');
    document.getElementById('sports-content').classList.remove('hidden');

    // Load sports configuration from API
    fetch('/api/v3/config/main')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                renderSportsConfig(data.data);
            } else {
                document.getElementById('sports-content').innerHTML =
                    '<p class="text-red-600">Error loading sports configuration: ' + data.message + '</p>';
            }
        })
        .catch(error => {
            document.getElementById('sports-content').innerHTML =
                '<p class="text-red-600">Error loading sports configuration: ' + error.message + '</p>';
        });
}

function renderSportsConfig(config) {
    const container = document.getElementById('sports-content');

    // Define sports leagues
    const leagues = [
        {
            key: 'nfl_scoreboard',
            label: 'NFL',
            color: 'blue',
            icon: 'fas fa-football-ball'
        },
        {
            key: 'mlb_scoreboard',
            label: 'MLB',
            color: 'green',
            icon: 'fas fa-baseball-ball'
        },
        {
            key: 'nhl_scoreboard',
            label: 'NHL',
            color: 'purple',
            icon: 'fas fa-hockey-puck'
        },
        {
            key: 'nba_scoreboard',
            label: 'NBA',
            color: 'orange',
            icon: 'fas fa-basketball-ball'
        },
        {
            key: 'ncaa_fb_scoreboard',
            label: 'NCAA Football',
            color: 'red',
            icon: 'fas fa-football-ball'
        },
        {
            key: 'soccer_scoreboard',
            label: 'Soccer',
            color: 'teal',
            icon: 'fas fa-futbol'
        }
    ];

    const html = leagues.map(league => {
        const leagueConfig = config[league.key] || {};
        const enabled = leagueConfig.enabled || false;
        const favoriteTeams = (leagueConfig.favorite_teams || []).join(', ');
        const liveInterval = leagueConfig.live_update_interval || 30;
        const recentInterval = leagueConfig.recent_update_interval || 3600;
        const upcomingInterval = leagueConfig.upcoming_update_interval || 3600;

        return `
            <div class="bg-gray-50 rounded-lg p-4 mb-4 border-l-4 border-${league.color}-500">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <i class="${league.icon} text-${league.color}-600 text-xl"></i>
                        <h3 class="text-lg font-medium text-gray-900">${league.label}</h3>
                        <label class="flex items-center">
                            <input type="checkbox"
                                   class="league-enabled"
                                   data-league="${league.key}"
                                   ${enabled ? 'checked' : ''}
                                   onchange="toggleLeague('${league.key}', this.checked)">
                            <span class="ml-2 text-sm font-medium">Enabled</span>
                        </label>
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex space-x-2">
                        <button onclick="startSportsMode('${league.key}', 'live')"
                                class="btn bg-${league.color}-600 hover:bg-${league.color}-700 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-bolt mr-1"></i>Live
                        </button>
                        <button onclick="startSportsMode('${league.key}', 'recent')"
                                class="btn bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-history mr-1"></i>Recent
                        </button>
                        <button onclick="startSportsMode('${league.key}', 'upcoming')"
                                class="btn bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-clock mr-1"></i>Upcoming
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Favorite Teams -->
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Favorite Teams
                        </label>
                        <input type="text"
                               class="league-favorites form-control"
                               data-league="${league.key}"
                               value="${favoriteTeams}"
                               placeholder="e.g., DAL, GB, KC">
                        <p class="mt-1 text-sm text-gray-600">Comma-separated team abbreviations</p>
                    </div>

                    <!-- Live Update Interval -->
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Live Update Interval (seconds)
                        </label>
                        <input type="number"
                               class="league-live-interval form-control"
                               data-league="${league.key}"
                               value="${liveInterval}"
                               min="10"
                               max="300">
                    </div>

                    <!-- Recent Update Interval -->
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Recent Games Interval (seconds)
                        </label>
                        <input type="number"
                               class="league-recent-interval form-control"
                               data-league="${league.key}"
                               value="${recentInterval}"
                               min="60"
                               max="3600">
                    </div>

                    <!-- Upcoming Update Interval -->
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Upcoming Games Interval (seconds)
                        </label>
                        <input type="number"
                               class="league-upcoming-interval form-control"
                               data-league="${league.key}"
                               value="${upcomingInterval}"
                               min="60"
                               max="3600">
                    </div>
                </div>

                <!-- Advanced Options -->
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Advanced Options</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="flex items-center">
                            <input type="checkbox"
                                   class="league-live-priority"
                                   data-league="${league.key}"
                                   ${leagueConfig.live_priority ? 'checked' : ''}>
                            <span class="ml-2 text-sm">Live Priority</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox"
                                   class="league-show-odds"
                                   data-league="${league.key}"
                                   ${leagueConfig.show_odds ? 'checked' : ''}>
                            <span class="ml-2 text-sm">Show Odds</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox"
                                   class="league-favorites-only"
                                   data-league="${league.key}"
                                   ${leagueConfig.show_favorite_teams_only ? 'checked' : ''}>
                            <span class="ml-2 text-sm">Favorites Only</span>
                        </label>
                    </div>
                </div>
            </div>
        `;
    }).join('');

    container.innerHTML = html;

    // Add save button
    container.innerHTML += `
        <div class="mt-6 pt-6 border-t border-gray-200 flex justify-end">
            <button onclick="saveSportsConfig()"
                    class="btn bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md">
                <i class="fas fa-save mr-2"></i>
                Save Sports Configuration
            </button>
        </div>
    `;
}

function toggleLeague(leagueKey, enabled) {
    // Visual feedback
    const checkbox = document.querySelector(`.league-enabled[data-league="${leagueKey}"]`);
    const container = checkbox.closest('.bg-gray-50');

    if (enabled) {
        container.classList.remove('opacity-50');
    } else {
        container.classList.add('opacity-50');
    }
}

function startSportsMode(leagueKey, mode) {
    fetch('/api/v3/system/action', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            action: 'start_display',
            mode: `${leagueKey}_${mode}`
        })
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, data.status);
    })
    .catch(error => {
        showNotification('Error starting sports mode: ' + error.message, 'error');
    });
}

function saveSportsConfig() {
    // Collect all league configurations
    const leagues = ['nfl_scoreboard', 'mlb_scoreboard', 'nhl_scoreboard', 'nba_scoreboard', 'ncaa_fb_scoreboard', 'soccer_scoreboard'];
    const config = {};

    leagues.forEach(leagueKey => {
        const enabled = document.querySelector(`.league-enabled[data-league="${leagueKey}"]`)?.checked || false;
        const favorites = document.querySelector(`.league-favorites[data-league="${leagueKey}"]`)?.value || '';
        const liveInterval = parseInt(document.querySelector(`.league-live-interval[data-league="${leagueKey}"]`)?.value) || 30;
        const recentInterval = parseInt(document.querySelector(`.league-recent-interval[data-league="${leagueKey}"]`)?.value) || 3600;
        const upcomingInterval = parseInt(document.querySelector(`.league-upcoming-interval[data-league="${leagueKey}"]`)?.value) || 3600;

        const livePriority = document.querySelector(`.league-live-priority[data-league="${leagueKey}"]`)?.checked || false;
        const showOdds = document.querySelector(`.league-show-odds[data-league="${leagueKey}"]`)?.checked || false;
        const favoritesOnly = document.querySelector(`.league-favorites-only[data-league="${leagueKey}"]`)?.checked || false;

        config[leagueKey] = {
            enabled,
            favorite_teams: favorites.split(',').map(t => t.trim()).filter(Boolean),
            live_update_interval: liveInterval,
            recent_update_interval: recentInterval,
            upcoming_update_interval: upcomingInterval,
            live_priority: livePriority,
            show_odds: showOdds,
            show_favorite_teams_only: favoritesOnly
        };
    });

    // Save configuration
    fetch('/api/v3/config/main', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(config)
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, data.status);
    })
    .catch(error => {
        showNotification('Error saving sports configuration: ' + error.message, 'error');
    });
}
</script>
